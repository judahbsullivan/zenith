<html>
  <head>
    <script>
      // Test logging helper
      function log(message) {
        const logEl = document.getElementById('test-log');
        if (logEl) {
          const time = new Date().toLocaleTimeString();
          logEl.setHTML(logEl.innerHTML + `<div>[${time}] ${message}</div>`);
          logEl.scrollTop = logEl.scrollHeight;
        }
        console.log(message);
      }

      // Test: addClass and removeClass
      function sayHi(event, el) {
        el.addClass('clicked');
        log("âœ“ addClass('clicked') - Button clicked!");
        setTimeout(() => {
          el.removeClass('clicked');
          log("âœ“ removeClass('clicked') - Class removed after 1s");
        }, 1000);
      }

      // Test: setText
      function updateValue(event, el) {
        const value = el.value;
        const displayEl = document.getElementById('value-display');
        if (displayEl) {
          displayEl.setText(`Current value: "${value}"`);
          log(`âœ“ setText() - Input value: "${value}"`);
        }
      }

      // Test: hide
      function submitForm(event, el) {
        event.preventDefault();
        log('âœ“ hide() - Form submitted, hiding form...');
        el.hide();
        setTimeout(() => {
          el.show();
          log('âœ“ show() - Form shown again after 2s');
        }, 2000);
      }

      // Test: show/hide toggle
      function toggleVisibility(event, el) {
        const targetEl = document.getElementById('toggle-target');
        if (targetEl) {
          if (targetEl.style.display === 'none') {
            targetEl.show();
            log('âœ“ show() - Toggle target is now visible');
          } else {
            targetEl.hide();
            log('âœ“ hide() - Toggle target is now hidden');
          }
        }
      }

      // Test: setHTML
      function updateHTML(event, el) {
        const htmlEl = document.getElementById('html-display');
        if (htmlEl) {
          const count = parseInt(htmlEl.getAttribute('data-count') || '0') + 1;
          htmlEl.setAttribute('data-count', count);
          htmlEl.setHTML(
            `Updated <strong>${count}</strong> time${count !== 1 ? 's' : ''} with <em>setHTML()</em>`
          );
          log(`âœ“ setHTML() - Updated HTML content (count: ${count})`);
        }
      }

      // Test: addClass/removeClass toggle
      function toggleClass(event, el) {
        const targetEl = document.getElementById('class-target');
        if (targetEl) {
          if (targetEl.classList.contains('highlight')) {
            targetEl.removeClass('highlight');
            log("âœ“ removeClass('highlight') - Removed highlight class");
          } else {
            targetEl.addClass('highlight');
            log("âœ“ addClass('highlight') - Added highlight class");
          }
        }
      }

      // Test: Attribute bindings - :class and :value
      function toggleActive(event, el) {
        state.isActive = !state.isActive;
        log(`âœ“ :class binding - isActive: ${state.isActive}`);
      }

      function toggleHidden(event, el) {
        state.isHidden = !state.isHidden;
        log(`âœ“ :class binding - isHidden: ${state.isHidden}`);
      }

      function updateUsername(event, el) {
        state.username = el.value;
        const display = document.getElementById('username-display');
        if (display) display.textContent = state.username;
        log(`âœ“ :value binding - username: "${state.username}"`);
      }

      function setUsernameToJudah(event, el) {
        state.username = 'Judah';
        const display = document.getElementById('username-display');
        if (display) display.textContent = state.username;
        log('âœ“ State updated: username = "Judah"');
      }

      // Test: Direct state mutation to verify reactivity
      function testStateMutation(event, el) {
        log('Testing direct state mutation...');
        state.isActive = true;
        state.isHidden = false;
        state.username = 'TestUser';
        log('âœ“ State mutated: isActive=true, isHidden=false, username="TestUser"');
        log('âœ“ Check DOM - classes and values should update automatically');
        
        // Update display
        const display = document.getElementById('username-display');
        if (display) display.textContent = state.username;
      }

      // Edge case tests
      function testMultipleStateDeps(event, el) {
        state.isActive = !state.isActive;
        state.isHidden = !state.isHidden;
        log(`âœ“ Multiple deps test - isActive: ${state.isActive}, isHidden: ${state.isHidden}`);
        
        // Verify synchronous update (no lifecycle drift)
        const testEl = document.getElementById('multiple-deps-test');
        if (testEl) {
          // Check immediately - should be updated synchronously
          const actualClasses = testEl.className;
          const expectedActive = state.isActive && !state.isHidden;
          const classList = actualClasses.split(/\s+/).filter(c => c);
          const hasActive = classList.includes('active') === expectedActive;
          const hasHidden = classList.includes('hidden') === state.isHidden;
          const hasVisible = classList.includes('visible') === !state.isHidden;
          const hasCombined = classList.includes('combined') === expectedActive;
          
          const allCorrect = hasActive && hasHidden && hasVisible && hasCombined;
          log(`:class updated -> ${actualClasses} (synchronous check: ${allCorrect ? 'âœ“' : 'âœ—'})`);
        }
      }

      function testFalsyProperties(event, el) {
        state.falsyTest = !state.falsyTest;
        state.undefinedTest = state.undefinedTest === undefined ? true : undefined;
        log(`âœ“ Falsy test - falsyTest: ${state.falsyTest}, undefinedTest: ${state.undefinedTest}`);
        
        // Verify synchronous update (no lifecycle drift)
        const testEl = document.getElementById('falsy-test');
        if (testEl) {
          // Check immediately - should be updated synchronously
          const actualClasses = testEl.className;
          const expectedClasses = ['display-box'];
          if (state.falsyTest) expectedClasses.push('active');
          if (state.undefinedTest) expectedClasses.push('undefined');
          expectedClasses.push('visible'); // always true
          
          const classList = actualClasses.split(/\s+/).filter(c => c);
          const hasAllExpected = expectedClasses.every(c => classList.includes(c));
          log(`:class updated -> ${actualClasses} (synchronous check: ${hasAllExpected ? 'âœ“' : 'âœ—'})`);
        }
      }

      function testStringClass(event, el) {
        state.stringClass = state.stringClass === 'class-a' ? 'class-b class-c' : 'class-a';
        log(`âœ“ String class test - stringClass: "${state.stringClass}"`);
        
        const testEl = document.getElementById('string-class-test');
        if (testEl) {
          log(`:class updated -> ${testEl.className}`);
        }
      }

      function testEmptyValue(event, el) {
        // Toggle between empty and non-empty to test edge case
        if (state.emptyValue === '' || state.emptyValue === undefined) {
          state.emptyValue = 'Non-empty value';
          log('âœ“ Empty value test - state.emptyValue set to "Non-empty value"');
        } else {
          state.emptyValue = '';
          log('âœ“ Empty value test - state.emptyValue set to empty string');
        }
        
        // Verify synchronous update (no lifecycle drift)
        const testEl = document.getElementById('empty-value-test');
        if (testEl) {
          // Check immediately - should be updated synchronously
          const actualValue = testEl.value;
          log(`:value updated -> "${actualValue}" (synchronous check: ${actualValue === state.emptyValue ? 'âœ“' : 'âœ—'})`);
        }
      }

      function testSpecialChars(event, el) {
        // Toggle between different special character sets
        const specialCharSets = [
          'Test & < > " \' Special',
          'Another &amp; &lt; &gt; Test',
          'Quotes: "double" and \'single\'',
          'Normal text'
        ];
        
        const currentIndex = specialCharSets.indexOf(state.specialChars);
        const nextIndex = (currentIndex + 1) % specialCharSets.length;
        state.specialChars = specialCharSets[nextIndex];
        
        log(`âœ“ Special chars test - state.specialChars: "${state.specialChars}"`);
        
        // Verify synchronous update (no lifecycle drift)
        const testEl = document.getElementById('special-chars-test');
        if (testEl) {
          // Check immediately - should be updated synchronously
          const actualValue = testEl.value;
          log(`:value updated -> "${actualValue}" (synchronous check: ${actualValue === state.specialChars ? 'âœ“' : 'âœ—'})`);
        }
      }

      function testNonExistentState(event, el) {
        // Toggle between existing and non-existent
        if (state.nonExistentState === undefined) {
          state.nonExistentState = 'Now exists!';
          log('âœ“ Non-existent state test - state.nonExistentState set to "Now exists!"');
        } else {
          delete state.nonExistentState;
          log('âœ“ Non-existent state test - deleted state.nonExistentState');
        }
        
        // Verify synchronous update (no lifecycle drift)
        const testEl = document.getElementById('non-existent-test');
        if (testEl) {
          // Check immediately - should be updated synchronously
          const actualValue = testEl.value;
          const expectedValue = state.nonExistentState || '';
          log(`:value updated -> "${actualValue}" (synchronous check: ${actualValue === expectedValue ? 'âœ“' : 'âœ—'})`);
        }
      }

      function testCombinedUpdates(event, el) {
        // Multiple state updates - all should happen synchronously
        state.isActive = !state.isActive;
        state.isHidden = !state.isHidden;
        state.username = 'CombinedTest' + Date.now();
        log(`âœ“ Combined test - isActive: ${state.isActive}, isHidden: ${state.isHidden}, username: "${state.username}"`);
        
        // Verify synchronous updates (no lifecycle drift)
        const classEl = document.getElementById('combined-class-test');
        const valueEl = document.getElementById('combined-value-test');
        
        if (classEl) {
          const actualClasses = classEl.className;
          const classList = actualClasses.split(/\s+/).filter(c => c);
          const hasActive = classList.includes('active') === state.isActive;
          const hasHidden = classList.includes('hidden') === state.isHidden;
          const hasVisible = classList.includes('visible') === !state.isHidden;
          const allCorrect = hasActive && hasHidden && hasVisible;
          log(`:class updated -> ${actualClasses} (synchronous check: ${allCorrect ? 'âœ“' : 'âœ—'})`);
        }
        
        if (valueEl) {
          const actualValue = valueEl.value;
          const valueCorrect = actualValue === state.username;
          log(`:value updated -> "${actualValue}" (synchronous check: ${valueCorrect ? 'âœ“' : 'âœ—'})`);
        }
        
        const display = document.getElementById('username-display');
        if (display) display.textContent = state.username;
      }

      // Initialize logging
      function initLog() {
        log('ðŸš€ Phase 2 Event System & DOM Helpers Test Suite');
        log(
          'All DOM helper methods are ready: show(), hide(), addClass(), removeClass(), setText(), setHTML()'
        );
        log('ðŸš€ Phase 2 Attribute Bindings - :class and :value');
        log('State initialized: isActive=false, isHidden=false, username=""');
        
        // Initialize username display
        const display = document.getElementById('username-display');
        if (display && window.state) {
          display.textContent = window.state.username || '';
        }
        
        // Verify state object exists
        if (window.state) {
          log('âœ“ State object is available: window.state');
        } else {
          log('âœ— ERROR: State object not found!');
        }
      }
    </script>
  </head>

  <body onload="initLog">
    <div class="container">
      <h1 class="title">Zenith Phase 2 Tests</h1>

      <div class="test-section">
        <h2>Event Handlers & DOM Helpers</h2>

        <div class="test-group">
          <button type="button" onclick="sayHi">
            Test addClass/removeClass
          </button>
          <span class="test-desc">Adds 'clicked' class, removes after 1s</span>
        </div>

        <div class="test-group">
          <input
            type="text"
            oninput="updateValue"
            placeholder="Type to test setText()"
          />
          <div id="value-display" class="display-box">
            Current value: (none)
          </div>
        </div>

        <div class="test-group">
          <form onsubmit="submitForm">
            <button type="submit">Test hide/show (form)</button>
          </form>
          <span class="test-desc">Hides form, shows after 2s</span>
        </div>

        <div class="test-group">
          <button type="button" onclick="toggleVisibility">
            Toggle Visibility
          </button>
          <div id="toggle-target" class="display-box">
            This element can be shown/hidden
          </div>
        </div>

        <div class="test-group">
          <button type="button" onclick="updateHTML">Test setHTML()</button>
          <div id="html-display" class="display-box" data-count="0">
            Click to update HTML content
          </div>
        </div>

        <div class="test-group">
          <button type="button" onclick="toggleClass">Toggle Class</button>
          <div id="class-target" class="display-box">
            This element's class can be toggled
          </div>
        </div>
      </div>

      <div class="test-section">
        <h2>Attribute Bindings (:class, :value)</h2>

        <div class="test-group">
          <h3>:class Binding - Object Syntax</h3>
          <button type="button" onclick="toggleActive">Toggle Active</button>
          <button type="button" onclick="toggleHidden">Toggle Hidden</button>
          <div :class="{ active: isActive, hidden: isHidden, visible: !isHidden }" class="display-box">
            This div's classes are bound to state.isActive and state.isHidden
          </div>
          <span class="test-desc">Classes update automatically when state changes</span>
        </div>

        <div class="test-group">
          <h3>:class Binding - Edge Cases</h3>
          <div :class="{}" class="display-box">
            Empty object binding (no classes)
          </div>
          <div :class="{ active: true, hidden: false, visible: true }" class="display-box">
            Mixed truthy/falsy values (only true values applied)
          </div>
          <div :class="'static-class'" class="display-box">
            String value (treated as raw class)
          </div>
        </div>

        <div class="test-group">
          <h3>:value Binding</h3>
          <input
            type="text"
            :value="username"
            oninput="updateUsername"
            placeholder="Type to update state.username"
          />
          <div class="display-box">
            Current state.username: "<span id="username-display"></span>"
          </div>
          <button type="button" onclick="setUsernameToJudah">
            Set username to "Judah"
          </button>
          <button type="button" onclick="testStateMutation">
            Test Direct State Mutation
          </button>
          <span class="test-desc">Input value is bound to state.username</span>
        </div>

        <div class="test-group">
          <h3>:class Edge Cases - Multiple State Dependencies</h3>
          <button type="button" onclick="testMultipleStateDeps">Toggle Multiple Dependencies</button>
          <div 
            id="multiple-deps-test"
            :class="{ active: isActive && !isHidden, hidden: isHidden, visible: !isHidden, combined: isActive && !isHidden }" 
            class="display-box"
          >
            Multiple state conditions: isActive && !isHidden
          </div>
          <span class="test-desc">Complex expression with multiple state properties</span>
        </div>

        <div class="test-group">
          <h3>:class Edge Cases - Falsy and Undefined</h3>
          <button type="button" onclick="testFalsyProperties">Toggle Falsy Properties</button>
          <div 
            id="falsy-test"
            :class="{ active: falsyTest, hidden: false, visible: true, undefined: undefinedTest }" 
            class="display-box"
          >
            Falsy test: only true values should be applied
          </div>
          <span class="test-desc">Only keys with true values are applied, falsy/undefined ignored</span>
        </div>

        <div class="test-group">
          <h3>:class Edge Cases - String Instead of Object</h3>
          <button type="button" onclick="testStringClass">Toggle String Class</button>
          <div 
            id="string-class-test"
            :class="stringClass" 
            class="display-box"
          >
            String value binding (not object)
          </div>
          <span class="test-desc">String values are applied as raw class names</span>
        </div>

        <div class="test-group">
          <h3>:value Edge Cases - Empty/Default Values</h3>
          <button type="button" onclick="testEmptyValue">Set Empty Value</button>
          <button type="button" onclick="testNonExistentState">Delete State Property</button>
          <input
            id="empty-value-test"
            type="text"
            :value="emptyValue"
            placeholder="Defaults to empty when undefined"
          />
          <input
            id="non-existent-test"
            type="text"
            :value="nonExistentState"
            placeholder="Non-existent state property"
          />
          <span class="test-desc">Handles empty strings and undefined state properties</span>
        </div>

        <div class="test-group">
          <h3>:value Edge Cases - Special Characters</h3>
          <button type="button" onclick="testSpecialChars">Set Special Characters</button>
          <input
            id="special-chars-test"
            type="text"
            :value="specialChars"
            placeholder="Handles &, <, >, quotes"
          />
          <span class="test-desc">Special characters: &, <, >, quotes are handled correctly</span>
        </div>

        <div class="test-group">
          <h3>Combined Test - Multiple State Updates</h3>
          <button type="button" onclick="testCombinedUpdates">Toggle All & Update Username</button>
          <div 
            id="combined-class-test"
            :class="{ active: isActive, hidden: isHidden, visible: !isHidden }" 
            class="display-box"
          >
            Combined class test - multiple state properties
          </div>
          <input
            id="combined-value-test"
            type="text"
            :value="username"
            placeholder="Combined binding test"
          />
          <span class="test-desc">Multiple state updates happen synchronously</span>
        </div>
      </div>

      <div class="log-section">
        <h2>Test Log</h2>
        <div id="test-log" class="log-box"></div>
      </div>
    </div>

    <style>
      body {
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        margin: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
      }

      .title {
        font-size: 48px;
        font-weight: 900;
        letter-spacing: 4px;
        color: white;
        text-align: center;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .test-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .test-section h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .test-group {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .test-desc {
        display: block;
        font-size: 12px;
        color: #666;
        margin-top: 8px;
        font-style: italic;
      }

      button {
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: background 0.2s;
      }

      button:hover {
        background: #5568d3;
      }

      button.clicked {
        background: #48bb78;
        transform: scale(1.05);
      }

      input {
        padding: 10px;
        border: 2px solid #e2e8f0;
        border-radius: 6px;
        font-size: 14px;
        width: 100%;
        max-width: 400px;
      }

      input:focus {
        outline: none;
        border-color: #667eea;
      }

      .display-box {
        margin-top: 10px;
        padding: 12px;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 6px;
        min-height: 40px;
        color: #333;
      }

      .display-box.highlight {
        background: #fef3c7;
        border-color: #f59e0b;
        font-weight: 600;
      }

      .display-box.active {
        background: #d1fae5;
        border-color: #10b981;
        font-weight: 600;
      }

      .display-box.hidden {
        display: none;
      }

      .display-box.visible {
        display: block;
      }

      .display-box.combined {
        border-width: 3px;
        font-weight: 700;
      }

      .log-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .log-section h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .log-box {
        background: #1a202c;
        color: #a0aec0;
        padding: 15px;
        border-radius: 6px;
        max-height: 300px;
        overflow-y: auto;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 12px;
        line-height: 1.6;
      }

      .log-box div {
        margin-bottom: 4px;
        padding: 2px 0;
      }

      .log-box div:last-child {
        color: #48bb78;
        font-weight: 600;
      }
    </style>
  </body>
</html>
